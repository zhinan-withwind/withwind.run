<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¥‡é—¨èµ·å¦å·¥å…· | éšé£</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-white text-gray-900">
    <main class="pt-28">




    <!-- Header and Navigation will be loaded by common.js -->
    
    <!-- Main Content -->
    <section class="min-h-screen pt-8 pb-12 px-8">
        <div class="max-w-4xl mx-auto">
            <!-- Title -->
            <div class="text-center mb-12 fade-in">
                <h1 class="text-4xl md:text-5xl font-light mb-4">å¥‡é—¨èµ·å¦å·¥å…·</h1>
                <p class="text-gray-600 text-lg">è¾“å…¥ä¸ªäººä¿¡æ¯ï¼Œç”Ÿæˆæ‚¨çš„å¥‡é—¨éç”²å‘½ç›˜</p>
            </div>
            
            <!-- Form Section -->
            <div class="bg-white border border-gray-200 rounded-lg p-8 mb-8 fade-in">
                <form id="divineForm" class="space-y-6">
                    <!-- Name Input -->
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700 mb-2">
                            å§“å <span class="text-gray-500">*</span>
                        </label>
                        <input type="text" id="name" name="name" required
                               class="w-full px-4 py-2 border border-gray-300 focus:ring-1 focus:ring-black focus:border-black outline-none transition-colors"
                               placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å">
                    </div>
                    
                    <!-- Birthday DateTime -->
                    <div>
                        <label for="birthday" class="block text-sm font-medium text-gray-700 mb-2">
                            ç”Ÿæ—¥ <span class="text-gray-500">*</span>
                        </label>
                        <input type="datetime-local" id="birthday" name="birthday" required
                               class="w-full px-4 py-2 border border-gray-300 focus:ring-1 focus:ring-black focus:border-black outline-none transition-colors">
                    </div>
                    
                    <!-- Sex Selection -->
                    <div>
                        <label for="sex" class="block text-sm font-medium text-gray-700 mb-2">
                            æ€§åˆ« <span class="text-gray-500">*</span>
                        </label>
                        <select id="sex" name="sex" required
                                class="w-full px-4 py-2 border border-gray-300 focus:ring-1 focus:ring-black focus:border-black outline-none transition-colors">
                            <option value="">è¯·é€‰æ‹©æ€§åˆ«</option>
                            <option value="1">ç”·</option>
                            <option value="0">å¥³</option>
                        </select>
                    </div>
                    
                    <!-- Region Selection -->
                    <div>
                        <label for="region-selector" class="block text-sm font-medium text-gray-700 mb-2">
                            åœ°åŒº <span class="text-gray-400">ï¼ˆé€‰å¡«ï¼‰</span>
                        </label>
                        <div id="region-selector" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <!-- Province Select -->
                                <div>
                                    <select id="province-select" 
                                            class="w-full px-4 py-2 border border-gray-300 focus:ring-1 focus:ring-black focus:border-black outline-none transition-colors">
                                        <option value="">è¯·é€‰æ‹©çœä»½</option>
                                    </select>
                                </div>
                                
                                <!-- City Select -->
                                <div>
                                    <select id="city-select" 
                                            class="w-full px-4 py-2 border border-gray-300 focus:ring-1 focus:ring-black focus:border-black outline-none transition-colors" 
                                            disabled>
                                        <option value="">è¯·é€‰æ‹©åŸå¸‚</option>
                                    </select>
                                </div>
                                
                                <!-- District Select -->
                                <div>
                                    <select id="district-select" 
                                            class="w-full px-4 py-2 border border-gray-300 focus:ring-1 focus:ring-black focus:border-black outline-none transition-colors" 
                                            disabled>
                                        <option value="">è¯·é€‰æ‹©åŒºå¿</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Selected Region Display -->
                            <div id="selected-region" class="hidden">
                                <span class="text-sm text-gray-600">å·²é€‰æ‹©ï¼š</span>
                                <span id="region-display" class="text-sm font-medium text-gray-800"></span>
                            </div>
                        </div>
                        <!-- Hidden input for form submission -->
                        <input type="hidden" id="region" name="region">
                        <input type="hidden" id="region-code" name="regionCode">
                    </div>
                    
                    <!-- Submit Button -->
                    <div class="pt-4">
                        <button type="submit" 
                                class="w-full bg-white text-black border border-black py-3 px-6 hover:bg-gray-100 transition-colors duration-200 font-light">
                            å¼€å§‹æ’ç›˜
                        </button>
                    </div>
                </form>
            </div>
            
            <!-- Loading State -->
            <div id="loadingSection" class="hidden text-center py-12">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-black mb-4"></div>
                <p class="text-gray-600">æ­£åœ¨ç”Ÿæˆå¥‡é—¨å‘½ç›˜ï¼Œè¯·ç¨å€™...</p>
            </div>
            
            <!-- Results Section -->
            <div id="resultsSection" class="hidden space-y-8 fade-in">
                <!-- Chart Image -->
                <div id="chartSection" class="hidden">
                    <h2 class="text-2xl font-light mb-6 text-center">å¥‡é—¨å‘½ç›˜å›¾</h2>
                    <div class="text-center">
                        <img id="chartImage" src="" alt="å¥‡é—¨å‘½ç›˜å›¾" 
                             class="max-w-full mx-auto border border-gray-200 rounded-lg shadow-sm">
                    </div>
                </div>
                
                <!-- Analysis Data -->
                <div id="analysisSection" class="hidden">
                    <h2 class="text-4xl md:text-5xl font-light mb-12 text-center text-gray-800">å‘½ç›˜åˆ†æ</h2>
                    
                    <!-- Basic Info Template -->
                    <div id="basicInfoTemplate" class="hidden bg-white border border-gray-200 rounded-lg p-8 mb-8 fade-in">
                        <h3 class="text-2xl font-light mb-6 text-gray-800">
                            <span id="personName"></span>ï¼ˆ<span id="title"></span>ï¼‰å¥‡é—¨éç”²å‘½ç›˜æ’ç›˜ä¿¡æ¯ï¼š
                        </h3>
                        <div class="space-y-4 text-gray-700 leading-relaxed font-light">
                            <div class="text-lg font-light">1ã€åŸºæœ¬ä¿¡æ¯ï¼š</div>
                            <div class="ml-6">ç”Ÿæ—¥ï¼š<span id="datetimeInfo" class="font-light"></span></div>
                            <div class="ml-6">å¹²æ”¯ï¼š<span id="ganZhiInfo" class="font-light"></span></div>
                            <div class="ml-6">é€‰å±€ï¼š<span id="pattern" class="font-light"></span></div>
                            <div class="ml-6">æ—¬é¦–ï¼š<span id="xunHead" class="font-light"></span></div>
                            <div class="ml-6">å€¼ç¬¦ï¼š<span id="dutyStar" class="font-light"></span></div>
                            <div class="ml-6">å€¼ä½¿ï¼š<span id="dutyDoor" class="font-light"></span></div>
                            <div class="ml-6">å±€åŠ¿ï¼š<span id="layout" class="font-light">è½¬ç›˜-æ‹†è¡¥-å¯„å¤äºŒå®«</span></div>
                            <div class="ml-6">ä¸Šä¸€ä¸ªèŠ‚æ°”ï¼š<br/><span id="lastSolarTerm" class="font-light"></span></div>
                            <div class="ml-6">ä¸‹ä¸€ä¸ªèŠ‚æ°”ï¼š<br/><span id="nextSolarTerm" class="font-light"></span></div>
                        </div>
                    </div>
                    
                    <!-- Palace Info Template -->
                    <div id="palaceInfoTemplate" class="hidden bg-white border border-gray-200 rounded-lg p-8 fade-in">
                        <h3 class="text-2xl font-light mb-6 text-gray-800">2ã€å…«å®«ä¿¡æ¯ï¼š</h3>
                        <div id="palaceList" class="space-y-3 text-gray-700 leading-relaxed"></div>
                    </div>
                    
                    <!-- No Data Message -->
                    <div id="noDataMessage" class="hidden bg-white border border-gray-200 rounded-lg p-12 text-center fade-in">
                        <p class="text-gray-500 text-lg">æš‚æ— åˆ†ææ•°æ®ï¼Œè¯·ç¨åé‡è¯•</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    
    <script>
        // Region data and selection functionality
        let regionData = [];
        let selectedProvince = null;
        let selectedCity = null;
        let selectedDistrict = null;
        
        // Load region data from JSON file
        async function loadRegionData() {
            try {
                const response = await fetch('./region.json');
                if (!response.ok) {
                    throw new Error('Failed to load region data');
                }
                regionData = await response.json();
                console.log('âœ… Region data loaded:', regionData.length, 'regions');
                initializeProvinceSelector();
            } catch (error) {
                console.error('âŒ Failed to load region data:', error);
            }
        }
        
        // Initialize province selector
        function initializeProvinceSelector() {
            const provinces = regionData.filter(region => region.parentId === 0);
            const provinceSelect = document.getElementById('province-select');
            
            provinces.forEach(province => {
                const option = document.createElement('option');
                option.value = province.code;
                option.textContent = province.name;
                option.dataset.id = province.id;
                provinceSelect.appendChild(option);
            });
            
            // Add change event listener
            provinceSelect.addEventListener('change', handleProvinceChange);
        }
        
        // Handle province selection
        function handleProvinceChange() {
            const provinceSelect = document.getElementById('province-select');
            const citySelect = document.getElementById('city-select');
            const districtSelect = document.getElementById('district-select');
            
            // Reset city and district selections
            citySelect.innerHTML = '<option value="">è¯·é€‰æ‹©åŸå¸‚</option>';
            districtSelect.innerHTML = '<option value="">è¯·é€‰æ‹©åŒºå¿</option>';
            citySelect.disabled = true;
            districtSelect.disabled = true;
            
            selectedProvince = null;
            selectedCity = null;
            selectedDistrict = null;
            
            const selectedProvinceCode = provinceSelect.value;
            if (!selectedProvinceCode) {
                updateRegionDisplay();
                return;
            }
            
            // Find selected province
            selectedProvince = regionData.find(region => region.code === selectedProvinceCode);
            
            // Load cities for this province
            const cities = regionData.filter(region => 
                region.parentId === selectedProvince.id
            );
            
            cities.forEach(city => {
                const option = document.createElement('option');
                option.value = city.code;
                option.textContent = city.name;
                option.dataset.id = city.id;
                citySelect.appendChild(option);
            });
            
            citySelect.disabled = false;
            citySelect.addEventListener('change', handleCityChange);
            updateRegionDisplay();
        }
        
        // Handle city selection
        function handleCityChange() {
            const citySelect = document.getElementById('city-select');
            const districtSelect = document.getElementById('district-select');
            
            // Reset district selection
            districtSelect.innerHTML = '<option value="">è¯·é€‰æ‹©åŒºå¿</option>';
            districtSelect.disabled = true;
            
            selectedCity = null;
            selectedDistrict = null;
            
            const selectedCityCode = citySelect.value;
            if (!selectedCityCode) {
                updateRegionDisplay();
                return;
            }
            
            // Find selected city
            selectedCity = regionData.find(region => region.code === selectedCityCode);
            
            // Load districts for this city
            const districts = regionData.filter(region => 
                region.parentId === selectedCity.id
            );
            
            if (districts.length > 0) {
                districts.forEach(district => {
                    const option = document.createElement('option');
                    option.value = district.code;
                    option.textContent = district.name;
                    option.dataset.id = district.id;
                    districtSelect.appendChild(option);
                });
                districtSelect.disabled = false;
                districtSelect.addEventListener('change', handleDistrictChange);
            }
            
            updateRegionDisplay();
        }
        
        // Handle district selection
        function handleDistrictChange() {
            const districtSelect = document.getElementById('district-select');
            const selectedDistrictCode = districtSelect.value;
            
            if (!selectedDistrictCode) {
                selectedDistrict = null;
            } else {
                selectedDistrict = regionData.find(region => region.code === selectedDistrictCode);
            }
            
            updateRegionDisplay();
        }
        
        // Update region display and hidden inputs
        function updateRegionDisplay() {
            const regionDisplay = document.getElementById('region-display');
            const selectedRegionDiv = document.getElementById('selected-region');
            const regionInput = document.getElementById('region');
            const regionCodeInput = document.getElementById('region-code');
            
            let regionNames = [];
            let regionCode = '';
            
            if (selectedProvince) {
                regionNames.push(selectedProvince.name);
                regionCode = selectedProvince.code;
            }
            
            if (selectedCity) {
                regionNames.push(selectedCity.name);
                regionCode = selectedCity.code;
            }
            
            if (selectedDistrict) {
                regionNames.push(selectedDistrict.name);
                regionCode = selectedDistrict.code;
            }
            
            if (regionNames.length > 0) {
                regionDisplay.textContent = regionNames.join('-');
                selectedRegionDiv.classList.remove('hidden');
                regionInput.value = regionNames.join('-');
                regionCodeInput.value = regionCode;
                console.log('ğŸ“ Region selected:', regionNames.join('-'), 'Code:', regionCode);
            } else {
                selectedRegionDiv.classList.add('hidden');
                regionInput.value = '';
                regionCodeInput.value = '';
            }
        }
        
        // Form submission handler
        document.getElementById('divineForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = {
                name: document.getElementById('name').value,
                birthday: document.getElementById('birthday').value,
                sex: document.getElementById('sex').value,
                region: document.getElementById('region').value,
                regionCode: document.getElementById('region-code').value,
            };
            
            // Validate required fields are filled
            if (!formData.name || !formData.birthday || !formData.sex) {
                alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µï¼ˆå§“åã€ç”Ÿæ—¥ã€æ€§åˆ«ï¼‰');
                return;
            }
            
            // Show loading
            document.getElementById('loadingSection').classList.remove('hidden');
            document.getElementById('resultsSection').classList.add('hidden');
            
            try {
                // Convert birthday to proper format for API
                const birthdayDate = new Date(formData.birthday);
                
                // Format for Chart API: YYYY-MM-DDTHH:mm
                const chartTimeFormat = birthdayDate.toISOString().slice(0, 16);
                
                // Format for Analysis API: YYYY-MM-DD HH:mm
                const year = birthdayDate.getFullYear();
                const month = String(birthdayDate.getMonth() + 1).padStart(2, '0');
                const day = String(birthdayDate.getDate()).padStart(2, '0');
                const hour = String(birthdayDate.getHours()).padStart(2, '0');
                const minute = String(birthdayDate.getMinutes()).padStart(2, '0');
                const analysisTimeFormat = `${year}-${month}-${day} ${hour}:${minute}`;
                
                // Debug: Log form data
                console.log('ğŸ“¤ Form Data:', formData);
                console.log('ğŸ• Chart Time Format:', chartTimeFormat);
                console.log('ğŸ• Analysis Time Format:', analysisTimeFormat);
                
                // Determine API URLs based on environment
                const isLocalDev = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
                console.log('ğŸŒ Environment:', isLocalDev ? 'Local Development' : 'Production');
                
                let chartUrl, analysisUrl;
                
                if (isLocalDev) {
                    // Use local proxy in development
                    chartUrl = `/api/zhouyi/qimen/divine/chart?divineTime=${encodeURIComponent(analysisTimeFormat)}&region=${encodeURIComponent(formData.regionCode)}`;
                    analysisUrl = `/api/zhouyi/qimen/analyzeForJiang?name=${encodeURIComponent(formData.name)}&birthday=${encodeURIComponent(analysisTimeFormat)}&region=${encodeURIComponent(formData.regionCode)}&sex=${encodeURIComponent(formData.sex)}`;
                } else {
                    // Use direct API in production
                    chartUrl = `https://app.withwind.run/zhouyi/qimen/divine/chart?divineTime=${encodeURIComponent(analysisTimeFormat)}&region=${encodeURIComponent(formData.regionCode)}`;
                    analysisUrl = `https://app.withwind.run/zhouyi/qimen/analyzeForJiang?name=${encodeURIComponent(formData.name)}&birthday=${encodeURIComponent(analysisTimeFormat)}&region=${encodeURIComponent(formData.regionCode)}&sex=${encodeURIComponent(formData.sex)}`;
                }
                
                console.log('ğŸ”— Chart URL:', chartUrl);
                console.log('ğŸ”— Analysis URL:', analysisUrl);
                
                // Make API calls in parallel
                const [chartResponse, analysisResponse] = await Promise.all([
                    fetch(chartUrl),
                    fetch(analysisUrl)
                ]);
                
                console.log('ğŸ“Š Chart Response Status:', chartResponse.status, chartResponse.statusText);
                console.log('ğŸ“Š Analysis Response Status:', analysisResponse.status, analysisResponse.statusText);
                
                // Handle chart image
                if (chartResponse.ok) {
                    console.log('âœ… Chart API successful');
                    const chartBlob = await chartResponse.blob();
                    console.log('ğŸ–¼ï¸ Chart blob size:', chartBlob.size, 'bytes');
                    
                    if (chartBlob.size > 0) {
                        const chartImageUrl = URL.createObjectURL(chartBlob);
                        document.getElementById('chartImage').src = chartImageUrl;
                        document.getElementById('chartSection').classList.remove('hidden');
                    } else {
                        console.warn('âš ï¸ Chart image is empty');
                    }
                } else {
                    console.error('âŒ Chart API failed:', chartResponse.status, chartResponse.statusText);
                    const errorText = await chartResponse.text();
                    console.error('Chart Error Response:', errorText);
                }
                
                // Handle analysis data
                if (analysisResponse.ok) {
                    console.log('âœ… Analysis API successful');
                    const analysisData = await analysisResponse.json();
                    console.log('ğŸ“‹ Analysis Data:', analysisData);
                    
                    displayAnalysisData(analysisData);
                    document.getElementById('analysisSection').classList.remove('hidden');
                } else {
                    console.error('âŒ Analysis API failed:', analysisResponse.status, analysisResponse.statusText);
                    const errorText = await analysisResponse.text();
                    console.error('Analysis Error Response:', errorText);
                }
                
                // Show results and hide loading
                document.getElementById('loadingSection').classList.add('hidden');
                document.getElementById('resultsSection').classList.remove('hidden');
                
            } catch (error) {
                console.error('ğŸ’¥ API request failed:', error);
                document.getElementById('loadingSection').classList.add('hidden');
                alert('æ’ç›˜è¯·æ±‚å¤±è´¥ï¼š' + error.message);
            }
        });
        
        function displayAnalysisData(data) {
            console.log('ğŸ¨ å¼€å§‹è§£ææ•°æ®:', data);
            
            // Hide all templates first
            document.getElementById('basicInfoTemplate').classList.add('hidden');
            document.getElementById('palaceInfoTemplate').classList.add('hidden');
            document.getElementById('noDataMessage').classList.add('hidden');
            
            // å¦‚æœæ•°æ®ä¸ºç©ºæˆ–æ— æ•ˆï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
            if (!data || (typeof data !== 'object')) {
                console.warn('âš ï¸ æ•°æ®ä¸ºç©ºæˆ–æ ¼å¼é”™è¯¯:', data);
                document.getElementById('noDataMessage').classList.remove('hidden');
                return;
            }
            
            // å¤„ç†åŸºæœ¬ä¿¡æ¯
            if (data.baseInfo) {
                const base = data.baseInfo;
                
                // å¡«å……åŸºæœ¬ä¿¡æ¯
                document.getElementById('personName').textContent = base.personName || '';
                document.getElementById('title').textContent = base.sex || '';
                
                // å¡«å……æ—¥æœŸæ—¶é—´ä¿¡æ¯
                const datetimeInfo = document.getElementById('datetimeInfo');
                let datetimeHtml = '';
                if (base.solarBirthday) {
                    datetimeHtml += `<p>å…¬å† ${base.solarBirthday}`;
                    if (base.lunarBirthday) {
                        datetimeHtml += `<br>å†œå† ${base.lunarBirthday}`;
                    }
                    if (base.apparentSolarTime) {
                        datetimeHtml += `<br>çœŸå¤ªé˜³æ—¶ ${base.apparentSolarTime}`;
                    }
                    datetimeHtml += '</p>';
                }
                datetimeInfo.innerHTML = datetimeHtml;
                
                // å¡«å……å¹²æ”¯ä¿¡æ¯
                const ganZhiInfo = document.getElementById('ganZhiInfo');
                let ganZhiHtml = '';
                if (base.ganZhiBirthday) {
                    ganZhiHtml += '<p>å››æŸ±ï¼š';
                    ganZhiHtml += `å¹´æŸ±/${base.ganZhiBirthday.ganZhiYear?.name || ''} `;
                    ganZhiHtml += `æœˆæŸ±/${base.ganZhiBirthday.ganZhiMonth?.name || ''} `;
                    ganZhiHtml += `æ—¥æŸ±/${base.ganZhiBirthday.ganZhiDay?.name || ''} `;
                    ganZhiHtml += `æ—¶æŸ±/${base.ganZhiBirthday.ganZhiTime?.name || ''}`;
                    ganZhiHtml += '</p>';
                }
                ganZhiInfo.innerHTML = ganZhiHtml;
                
                // å¡«å……å…¶ä»–ä¿¡æ¯
                document.getElementById('pattern').textContent = base.pattern || '';
                document.getElementById('xunHead').textContent = base.xunHead || '';
                document.getElementById('dutyStar').textContent = base.dutyStar || '';
                document.getElementById('dutyDoor').textContent = base.dutyDoor || '';
                
                // å¤„ç†èŠ‚æ°”
                document.getElementById('lastSolarTerm').textContent = 
                    base.lastSolarTerm ? `${base.lastSolarTerm.name || ''} ${base.lastSolarTerm.dateTime || ''}` : '';
                document.getElementById('nextSolarTerm').textContent = 
                    base.nextSolarTerm ? `${base.nextSolarTerm.name || ''} ${base.nextSolarTerm.dateTime || ''}` : '';
                
                // æ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯æ¨¡æ¿
                document.getElementById('basicInfoTemplate').classList.remove('hidden');
            }
            
            // å¤„ç†å…«å®«ä¿¡æ¯
            if (data.palaceInfo) {
                const palaceList = document.getElementById('palaceList');
                let palaceHtml = '';
                
                const orderSeq = ["å·½å››å®«", "ç¦»ä¹å®«", "å¤äºŒå®«", "å…‘ä¸ƒå®«", "ä¹¾å…­å®«", "åä¸€å®«", "è‰®å…«å®«", "éœ‡ä¸‰å®«"];
                
                orderSeq.forEach(palaceName => {
                    const palace = data.palaceInfo[palaceName];
                    if (palace) {
                        const doorName = palace.door?.fullName || palace.door?.name || '';
                        const starName = palace.star?.name || palace.star?.shortName || '';
                        const deityName = palace.deity?.name || palace.deity?.shortName || '';
                        const tGan = palace.heaven?.gan?.name || '';
                        const tStat = palace.heaven?.statuses || '';
                        const dGan = palace.ground?.gan?.name || '';
                        const dStat = palace.ground?.statuses || '';
                        
                        const isKongWang = (palace.isTimeEmpty);
                        const isMaXing = palace.isHorse || false;
                        const isRuMu = (palace.ground?.isEnterTomb) || (dStat?.includes('å¢“'));
                        const isNative = palace.isNative || false;
                        
                        palaceHtml += `<p><strong class="font-light">${palaceName}ï¼š</strong>${doorName}/${starName}/${deityName} å¤©${tGan}`;
                        if (tStat) palaceHtml += `<span class="text-gray-600 font-light">ã€${tStat}ã€‘</span>`;
                        palaceHtml += `/åœ°${dGan}`;
                        if (dStat) palaceHtml += `<span class="text-gray-600 font-light">ã€${dStat}ã€‘</span>`;
                        if (isKongWang) palaceHtml += ' <span class="text-gray-700 font-medium">ç©ºäº¡</span>';
                        if (isMaXing) palaceHtml += ' <span class="text-gray-700 font-medium">é©¬æ˜Ÿ</span>';
                        if (isRuMu) palaceHtml += ' <span class="text-gray-700 font-medium">å…¥å¢“</span>';
                        if (isNative) palaceHtml += ' ï¼ˆ<span class="text-gray-700 font-medium">æœ¬å®«</span>ï¼‰';
                        palaceHtml += '</p>';
                    }
                });
                
                palaceList.innerHTML = palaceHtml;
                document.getElementById('palaceInfoTemplate').classList.remove('hidden');
            }
            
            console.log('âœ… æ•°æ®è§£æå®Œæˆå¹¶æ˜¾ç¤º');
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Load region data
            loadRegionData();
            
            // Initialize fade-in animations
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };
            
            const observer = new IntersectionObserver(function(entries) {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, observerOptions);
            
            document.querySelectorAll('.fade-in').forEach(el => {
                observer.observe(el);
            });
        });
    </script>
    </main>

<script src="../../../scripts/main.js"></script>
    <script src="../../../../js/common.js"></script>
</body>
</html>
