<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂÖ≠ÁàªËµ∑Âç¶ÁïåÈù¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/zh.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .container {
            max-width: 420px;
        }
        .picker-select {
            @apply w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-300;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="container mx-auto p-6 bg-white rounded-2xl shadow-xl space-y-8">
        <!-- Ê†áÈ¢ò -->
        <div class="text-center">
            <h1 class="text-2xl font-bold text-gray-800">ÂÖ≠ÁàªËµ∑Âç¶</h1>
        </div>

        <!-- Ëµ∑Âç¶Êó∂Èó¥ -->
        <div class="space-y-4">
            <div class="flex items-center justify-between text-lg font-medium text-gray-700">
                <span class="mr-2">Ëµ∑Âç¶Êó∂Èó¥ (ÂÖ¨ÂéÜ)</span>
                <label for="datetimePicker"></label><input type="text" id="datetimePicker" class="picker-select w-44 text-right">
            </div>
        </div>

        <!-- Âç¶Ë±°ÈÄâÊã© -->
        <div class="space-y-4">
            <h2 class="text-lg font-medium text-gray-700">ÊëáÂç¶</h2>
            <div id="hexagrams-list" class="space-y-3">
                <!-- Âç¶ÁàªÂ∞ÜÈÄöËøá JavaScript Âä®ÊÄÅÁîüÊàê -->
            </div>
        </div>

        <!-- Ëµ∑Âç¶ÊåâÈíÆ -->
        <div class="pt-4">
            <button id="startDivination" class="w-full py-3 bg-indigo-600 text-white font-bold rounded-xl shadow-lg hover:bg-indigo-700 transition-all duration-300 focus:outline-none focus:ring-4 focus:ring-indigo-500/50">
                Ëµ∑Âç¶
            </button>
        </div>
    </div>

    <!-- ÂºπÁ™óÔºàÁî®‰∫éÊèêÁ§∫‰ø°ÊÅØÔºâ -->
    <div id="messageBox" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center transition-opacity duration-300">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm mx-auto text-center">
            <p id="messageText" class="text-lg font-semibold text-gray-800 mb-4"></p>
            <button id="closeButton" class="bg-indigo-500 text-white px-4 py-2 rounded-lg hover:bg-indigo-600">Á°ÆÂÆö</button>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const GUA_YAO_OPTIONS = [
                { value: "0", text: "ËØ∑ÈÄâÊã©" },
                { value: "6", text: "Ê≤°ÊúâËä± „äôÔ∏è „äôÔ∏è „äôÔ∏è" },
                { value: "7", text: "‰∏Ä‰∏™Ëä± üå∏ „äôÔ∏è „äôÔ∏è" },
                { value: "8", text: "‰∏§‰∏™Ëä± üå∏ üå∏ „äôÔ∏è" },
                { value: "9", text: "‰∏â‰∏™Ëä± üå∏ üå∏ üå∏" }
            ];

            const hexagramsList = document.getElementById('hexagrams-list');
            const messageBox    = document.getElementById('messageBox');
            const messageText   = document.getElementById('messageText');
            const closeButton   = document.getElementById('closeButton');
            
            // Â≠òÂÇ®Âç¶Ë±°ÈÄâÊã©ÁªìÊûú
            let hexagramSelections = {};

            // Âä®ÊÄÅÁîüÊàêÂÖ≠ÁàªÈÄâÊã©ÁïåÈù¢
            const yaos = ['Á¨¨‰∏ÄÊ¨°ÊëáÂç¶', 'Á¨¨‰∫åÊ¨°ÊëáÂç¶', 'Á¨¨‰∏âÊ¨°ÊëáÂç¶', 'Á¨¨ÂõõÊ¨°ÊëáÂç¶', 'Á¨¨‰∫îÊ¨°ÊëáÂç¶', 'Á¨¨ÂÖ≠Ê¨°ÊëáÂç¶'];
            yaos.forEach((yaoName, index) => {
                const yaoDiv = document.createElement('div');
                yaoDiv.className = 'flex items-center justify-between';
                yaoDiv.innerHTML = `
                    <label class="text-gray-600">${yaoName}</label>
                    <div class="relative w-44">
                        <select id="yao-${index}" class="picker-select appearance-none cursor-pointer text-gray-500">
                            ${GUA_YAO_OPTIONS.map(option => `<option value="${option.value}">${option.text}</option>`).join('')}
                        </select>
                    </div>
                `;
                hexagramsList.appendChild(yaoDiv);

                // ÁõëÂê¨ÈÄâÊã©ÂèòÂåñÂπ∂Êõ¥Êñ∞Áä∂ÊÄÅ
                const selectElement = yaoDiv.querySelector('select');
                selectElement.addEventListener('change', (e) => {
                    hexagramSelections[yaoName] = e.target.value;
                });
            });

            // ÂàùÂßãÂåñ flatpickr Êó•ÊúüÊó∂Èó¥ÈÄâÊã©Âô®
            const flatpickrInstance = flatpickr("#datetimePicker", {
                enableTime: true,
                dateFormat: "Y-m-d H:i",
                defaultDate: new Date(),
                locale: 'zh'
            });

            // Ëµ∑Âç¶ÊåâÈíÆÁÇπÂáª‰∫ã‰ª∂
            document.getElementById('startDivination').addEventListener('click', () => {
                const time = flatpickrInstance.selectedDates[0];
                const selections = Array.from(document.querySelectorAll('#hexagrams-list select')).map(select => ({
                    yao: select.closest('.flex').querySelector('label').textContent,
                    value: select.value
                }));

                // È™åËØÅÊâÄÊúâÂç¶ÁàªÊòØÂê¶ÈÉΩÂ∑≤ÈÄâÊã©
                const isComplete = selections.every(sel => sel.value !== '0');
                if (!isComplete) {
                    showMessage('ËØ∑ÂÆåÊï¥ÈÄâÊã©ÊâÄÊúâÂÖ≠‰∏™Âç¶Áàª„ÄÇ');
                    return;
                }
                
                // Â∞ÜÊï∞ÊçÆÁªÑÂêàÊàê‰∏Ä‰∏™ÂØπË±°
                const divinationData = {
                    divineTime: flatpickr.formatDate(time, "Y-m-d\\TH:i"),
                    data: selections.map(option => option.value).join('')
                };

                console.log("Ëµ∑Âç¶Êï∞ÊçÆ:", divinationData);
                showMessage('Ëµ∑Âç¶ÊàêÂäüÔºÅ\n' + JSON.stringify(divinationData, null, 2));
            });

            // ÊòæÁ§∫Ê∂àÊÅØÂºπÁ™ó
            function showMessage(msg) {
                messageText.textContent = msg;
                messageBox.classList.remove('hidden');
                messageBox.classList.add('flex');
            }

            // ÂÖ≥Èó≠ÂºπÁ™ó
            closeButton.addEventListener('click', () => {
                messageBox.classList.add('hidden');
                messageBox.classList.remove('flex');
            });
        });
    </script>
</body>
</html>
