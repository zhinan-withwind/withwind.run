<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>八字排盘 - 信息输入 | Bazi Input</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f5f5 0%, #ffffff 100%);
            min-height: 100vh;
            color: #000;
        }
        
        .input-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .form-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 2.5rem;
            animation: fadeInUp 0.8s ease-out;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #374151;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .form-input {
            width: 100%;
            padding: 0.875rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #fafafa;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            background: white;
            transform: translateY(-2px);
        }
        
        .form-select {
            width: 100%;
            padding: 0.875rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #fafafa;
            cursor: pointer;
        }
        
        .form-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            background: white;
        }
        
        .location-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn-primary:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .page-title {
            text-align: center;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .page-subtitle {
            text-align: center;
            color: #6b7280;
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }
        
        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 0.75rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            animation: shake 0.5s ease-in-out;
        }
        
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #ffffff;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.5rem;
        }
        
        .datetime-input {
            position: relative;
        }
        
        .datetime-input input[type="datetime-local"] {
            appearance: none;
            -webkit-appearance: none;
        }
        
        .datetime-input::before {
            content: '\f073';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #6b7280;
            pointer-events: none;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .location-grid {
                grid-template-columns: 1fr;
            }
            
            .input-container {
                padding: 1rem;
            }
            
            .form-card {
                padding: 1.5rem;
            }
            
            .page-title {
                font-size: 1.5rem;
            }
        }
        
        /* 隐藏原生日期时间选择器的箭头 */
        input[type="datetime-local"]::-webkit-calendar-picker-indicator {
            filter: invert(0.5);
            cursor: pointer;
        }
        
        .input-hint {
            font-size: 0.8rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }
    </style>
</head>
<body>
    <div class="input-container">
        <div class="form-card">
            <h1 class="page-title">八字排盘系统</h1>
            <p class="page-subtitle">请填写您的个人信息以生成八字排盘</p>
            
            <div id="errorContainer"></div>
            
            <form id="baziInputForm">
                <div class="form-group">
                    <label class="form-label" for="name">
                        <i class="fas fa-user mr-2"></i>姓名
                    </label>
                    <input type="text" id="name" name="name" class="form-input" 
                           placeholder="请输入您的姓名" required>
                    <div class="input-hint">请输入真实姓名，用于排盘显示</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="gender">
                        <i class="fas fa-venus-mars mr-2"></i>性别
                    </label>
                    <select id="gender" name="gender" class="form-select" required>
                        <option value="">请选择性别</option>
                        <option value="男">男</option>
                        <option value="女">女</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-map-marker-alt mr-2"></i>出生地
                    </label>
                    <div class="location-grid">
                        <div>
                            <select id="province" name="province" class="form-select" required>
                                <option value="">选择省份</option>
                            </select>
                        </div>
                        <div>
                            <select id="city" name="city" class="form-select" required disabled>
                                <option value="">选择城市</option>
                            </select>
                        </div>
                        <div>
                            <select id="area" name="area" class="form-select" required disabled>
                                <option value="">选择地区</option>
                            </select>
                        </div>
                    </div>
                    <div class="input-hint">请选择详细的出生地址，用于确定时区</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="birthdate">
                        <i class="fas fa-calendar-alt mr-2"></i>出生时间
                    </label>
                    <div class="datetime-input">
                        <input type="datetime-local" id="birthdate" name="birthdate" 
                               class="form-input" required>
                    </div>
                    <div class="input-hint">请选择准确的出生日期和时间</div>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn-primary" id="submitBtn">
                        <span id="btnText">生成八字排盘</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // 中国省市地区数据
        const locationData = {
            '北京市': {
                '北京市': ['东城区', '西城区', '朝阳区', '丰台区', '石景山区', '海淀区', '门头沟区', '房山区', '通州区', '顺义区', '昌平区', '大兴区', '怀柔区', '平谷区', '密云区', '延庆区']
            },
            '上海市': {
                '上海市': ['黄浦区', '徐汇区', '长宁区', '静安区', '普陀区', '虹口区', '杨浦区', '闵行区', '宝山区', '嘉定区', '浦东新区', '金山区', '松江区', '青浦区', '奉贤区', '崇明区']
            },
            '广东省': {
                '广州市': ['越秀区', '海珠区', '荔湾区', '天河区', '白云区', '黄埔区', '番禺区', '花都区', '南沙区', '从化区', '增城区'],
                '深圳市': ['罗湖区', '福田区', '南山区', '宝安区', '龙岗区', '盐田区', '龙华区', '坪山区', '光明区', '大鹏新区'],
                '珠海市': ['香洲区', '斗门区', '金湾区'],
                '东莞市': ['莞城街道', '南城街道', '东城街道', '万江街道', '石碣镇', '石龙镇', '茶山镇', '石排镇', '企石镇', '横沥镇', '桥头镇', '谢岗镇', '东坑镇', '常平镇', '寮步镇', '樟木头镇', '大朗镇', '黄江镇', '清溪镇', '塘厦镇', '凤岗镇', '大岭山镇', '长安镇', '虎门镇', '厚街镇', '沙田镇', '道滘镇', '洪梅镇', '麻涌镇', '望牛墩镇', '中堂镇', '高埗镇'],
                '佛山市': ['禅城区', '南海区', '顺德区', '三水区', '高明区']
            },
            '江苏省': {
                '南京市': ['玄武区', '秦淮区', '建邺区', '鼓楼区', '浦口区', '栖霞区', '雨花台区', '江宁区', '六合区', '溧水区', '高淳区'],
                '苏州市': ['虎丘区', '吴中区', '相城区', '姑苏区', '吴江区', '常熟市', '张家港市', '昆山市', '太仓市'],
                '无锡市': ['锡山区', '惠山区', '滨湖区', '梁溪区', '新吴区', '江阴市', '宜兴市']
            },
            '浙江省': {
                '杭州市': ['上城区', '下城区', '江干区', '拱墅区', '西湖区', '滨江区', '萧山区', '余杭区', '富阳区', '临安区', '建德市', '桐庐县', '淳安县'],
                '宁波市': ['海曙区', '江北区', '北仑区', '镇海区', '鄞州区', '奉化区', '余姚市', '慈溪市', '象山县', '宁海县'],
                '温州市': ['鹿城区', '龙湾区', '瓯海区', '洞头区', '永嘉县', '平阳县', '苍南县', '文成县', '泰顺县', '瑞安市', '乐清市', '龙港市']
            },
            '山东省': {
                '济南市': ['历下区', '市中区', '槐荫区', '天桥区', '历城区', '长清区', '章丘区', '济阳区', '莱芜区', '钢城区', '平阴县', '商河县'],
                '青岛市': ['市南区', '市北区', '李沧区', '崂山区', '西海岸新区', '城阳区', '即墨区', '胶州市', '平度市', '莱西市']
            },
            '河南省': {
                '郑州市': ['中原区', '二七区', '管城回族区', '金水区', '上街区', '惠济区', '中牟县', '巩义市', '荥阳市', '新密市', '新郑市', '登封市'],
                '洛阳市': ['老城区', '西工区', '瀍河回族区', '涧西区', '吉利区', '洛龙区', '孟津区', '偃师市', '新安县', '栾川县', '嵩县', '汝阳县', '宜阳县', '洛宁县', '伊川县']
            },
            '四川省': {
                '成都市': ['锦江区', '青羊区', '金牛区', '武侯区', '成华区', '龙泉驿区', '青白江区', '新都区', '温江区', '双流区', '郫都区', '新津区', '都江堰市', '彭州市', '邛崃市', '崇州市', '简阳市', '金堂县', '大邑县', '蒲江县'],
                '绵阳市': ['涪城区', '游仙区', '安州区', '江油市', '三台县', '盐亭县', '梓潼县', '北川羌族自治县', '平武县']
            }
        };

        // 初始化省份选择器
        function initializeProvinceSelector() {
            const provinceSelect = document.getElementById('province');
            const provinces = Object.keys(locationData);
            
            provinces.forEach(province => {
                const option = document.createElement('option');
                option.value = province;
                option.textContent = province;
                provinceSelect.appendChild(option);
            });
        }

        // 省份选择变化处理
        function handleProvinceChange() {
            const provinceSelect = document.getElementById('province');
            const citySelect = document.getElementById('city');
            const areaSelect = document.getElementById('area');
            const selectedProvince = provinceSelect.value;
            
            // 清空城市和地区选择器
            citySelect.innerHTML = '<option value="">选择城市</option>';
            areaSelect.innerHTML = '<option value="">选择地区</option>';
            areaSelect.disabled = true;
            
            if (selectedProvince && locationData[selectedProvince]) {
                citySelect.disabled = false;
                const cities = Object.keys(locationData[selectedProvince]);
                
                cities.forEach(city => {
                    const option = document.createElement('option');
                    option.value = city;
                    option.textContent = city;
                    citySelect.appendChild(option);
                });
            } else {
                citySelect.disabled = true;
            }
        }

        // 城市选择变化处理
        function handleCityChange() {
            const provinceSelect = document.getElementById('province');
            const citySelect = document.getElementById('city');
            const areaSelect = document.getElementById('area');
            const selectedProvince = provinceSelect.value;
            const selectedCity = citySelect.value;
            
            // 清空地区选择器
            areaSelect.innerHTML = '<option value="">选择地区</option>';
            
            if (selectedProvince && selectedCity && locationData[selectedProvince][selectedCity]) {
                areaSelect.disabled = false;
                const areas = locationData[selectedProvince][selectedCity];
                
                areas.forEach(area => {
                    const option = document.createElement('option');
                    option.value = area;
                    option.textContent = area;
                    areaSelect.appendChild(option);
                });
            } else {
                areaSelect.disabled = true;
            }
        }

        // 表单验证
        function validateForm() {
            const form = document.getElementById('baziInputForm');
            const formData = new FormData(form);
            const errors = [];

            if (!formData.get('name')?.trim()) {
                errors.push('请输入姓名');
            }

            if (!formData.get('gender')) {
                errors.push('请选择性别');
            }

            if (!formData.get('province')) {
                errors.push('请选择省份');
            }

            if (!formData.get('city')) {
                errors.push('请选择城市');
            }

            if (!formData.get('area')) {
                errors.push('请选择地区');
            }

            if (!formData.get('birthdate')) {
                errors.push('请选择出生时间');
            }

            return errors;
        }

        // 显示错误信息
        function showErrors(errors) {
            const errorContainer = document.getElementById('errorContainer');
            errorContainer.innerHTML = '';
            
            if (errors.length > 0) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-message';
                errorDiv.innerHTML = `
                    <i class="fas fa-exclamation-triangle mr-2"></i>
                    <strong>请修正以下错误：</strong>
                    <ul class="mt-2 ml-4">
                        ${errors.map(error => `<li>${error}</li>`).join('')}
                    </ul>
                `;
                errorContainer.appendChild(errorDiv);
                
                // 5秒后自动隐藏
                setTimeout(() => {
                    errorDiv.style.opacity = '0';
                    errorDiv.style.transition = 'opacity 0.5s ease';
                    setTimeout(() => errorDiv.remove(), 500);
                }, 5000);
            }
        }

        // 设置出生时间输入的最小值为1900年
        function setDateTimeInputConstraints() {
            const birthdateInput = document.getElementById('birthdate');
            const minDate = new Date('1900-01-01T00:00');
            const maxDate = new Date();
            
            birthdateInput.min = minDate.toISOString().slice(0, 16);
            birthdateInput.max = maxDate.toISOString().slice(0, 16);
        }

        // 表单提交处理
        function handleFormSubmit(e) {
            e.preventDefault();
            
            // 清除之前的错误信息
            const errorContainer = document.getElementById('errorContainer');
            errorContainer.innerHTML = '';
            
            // 验证表单
            const errors = validateForm();
            if (errors.length > 0) {
                showErrors(errors);
                return;
            }
            
            // 收集表单数据
            const formData = new FormData(e.target);
            const data = {
                name: formData.get('name'),
                gender: formData.get('gender'),
                province: formData.get('province'),
                city: formData.get('city'),
                area: formData.get('area'),
                birthplace: `${formData.get('province')}${formData.get('city')}${formData.get('area')}`,
                birthdate: formData.get('birthdate')
            };
            
            // 显示加载状态
            const submitBtn = document.getElementById('submitBtn');
            const btnText = document.getElementById('btnText');
            const originalText = btnText.textContent;
            
            submitBtn.disabled = true;
            btnText.innerHTML = '<span class="loading"></span>正在生成排盘...';
            
            // 模拟处理时间
            setTimeout(() => {
                // 将数据存储到localStorage
                localStorage.setItem('baziData', JSON.stringify(data));
                
                // 跳转到排盘页面
                window.location.href = 'bazi-chart.html';
            }, 1500);
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化省份选择器
            initializeProvinceSelector();
            
            // 设置日期时间输入约束
            setDateTimeInputConstraints();
            
            // 绑定事件监听器
            document.getElementById('province').addEventListener('change', handleProvinceChange);
            document.getElementById('city').addEventListener('change', handleCityChange);
            document.getElementById('baziInputForm').addEventListener('submit', handleFormSubmit);
            
            // 输入框焦点效果
            const inputs = document.querySelectorAll('.form-input, .form-select');
            inputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.parentElement.style.transform = 'scale(1.02)';
                    this.parentElement.style.transition = 'transform 0.2s ease';
                });
                
                input.addEventListener('blur', function() {
                    this.parentElement.style.transform = 'scale(1)';
                });
                
                // 实时验证
                input.addEventListener('input', function() {
                    if (this.value.trim()) {
                        this.style.borderColor = '#10b981';
                    } else {
                        this.style.borderColor = '#e5e7eb';
                    }
                });
            });
            
            // 键盘快捷键
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 'Enter') {
                    handleFormSubmit(e);
                }
            });
            
            // 显示快捷键提示
            setTimeout(() => {
                const hint = document.createElement('div');
                hint.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    padding: 0.5rem 1rem;
                    border-radius: 6px;
                    font-size: 0.8rem;
                    z-index: 1000;
                    opacity: 0;
                    transition: opacity 0.3s ease;
                `;
                hint.innerHTML = '<i class="fas fa-keyboard mr-2"></i>快捷键: Ctrl+Enter 提交';
                document.body.appendChild(hint);
                
                setTimeout(() => hint.style.opacity = '1', 100);
                setTimeout(() => {
                    hint.style.opacity = '0';
                    setTimeout(() => hint.remove(), 300);
                }, 5000);
            }, 2000);
        });
    </script>
</body>
</html>